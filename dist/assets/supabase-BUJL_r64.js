var T=Object.defineProperty,_=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var f=(e,t,r)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,g=(e,t)=>{for(var r in t||(t={}))b.call(t,r)&&f(e,r,t[r]);if(h)for(var r of h(t))D.call(t,r)&&f(e,r,t[r]);return e},w=(e,t)=>_(e,C(t));var c=(e,t,r)=>new Promise((o,n)=>{var d=s=>{try{i(r.next(s))}catch(u){n(u)}},p=s=>{try{i(r.throw(s))}catch(u){n(u)}},i=s=>s.done?o(s.value):Promise.resolve(s.value).then(d,p);i((r=r.apply(e,t)).next())});import{c as U}from"./supabase-CxI1Zui4.js";import{d as B,e as P}from"./index-DvcXioQz.js";import"./react-vendor-M-FLgoaJ.js";const a=U(P,B,{realtime:{params:{eventsPerSecond:2}},auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),x=()=>{try{a.realtime&&a.realtime.disconnect()}catch(e){}},l=(e,t=6e3)=>c(void 0,null,function*(){let r;const o=new Promise((n,d)=>{r=setTimeout(()=>d(new Error("Request timed out")),t)});try{const n=yield Promise.race([e,o]);return clearTimeout(r),n}catch(n){throw clearTimeout(r),n}}),m=e=>{if(!e)return"BTC";let t=e.toUpperCase().trim();return t=t.replace(/[^A-Z0-9]/g,""),t!=="USDT"&&t.endsWith("USDT")&&(t=t.replace("USDT","")),t},q=()=>`sess_${Math.random().toString(36).substr(2,9)}`,A=(e,t)=>{try{const r={session_id:e,product_sku:t.product_sku,product:t.product_sku.replace(/-/g," ").toUpperCase(),total:t.option_price_usd||0,crypto:m(t.crypto),email:t.email,created_at:new Date().toISOString(),status:"pending",expires_at:new Date(Date.now()+18e5).toISOString()};sessionStorage.setItem(`mock_order_${e}`,JSON.stringify(r))}catch(r){}},S=e=>{try{const t=sessionStorage.getItem(`mock_order_${e}`);if(t)return JSON.parse(t)}catch(t){}return{product:"Unknown Product",total:0,crypto:"BTC",email:"error@example.com",expires_at:new Date(Date.now()+30*60*1e3).toISOString()}},I=()=>c(void 0,null,function*(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),r=yield fetch("https://api.ipify.org?format=json",{signal:e.signal});return clearTimeout(t),(yield r.json()).ip}catch(e){try{const{data:t,error:r}=yield l(a.functions.invoke("get-ip-g",{method:"GET"}),5e3);if(r)throw r;return t.ip||t.clientIp||(typeof t=="string"?t:"0.0.0.0")}catch(t){return"0.0.0.0"}}}),j=e=>c(void 0,null,function*(){const t=w(g({},e),{crypto:m(e.crypto)});try{const{data:r,error:o}=yield l(a.functions.invoke("checkout-create",{body:t}),1e4);if(o)throw o;return r}catch(r){const o=q();return A(o,t),{session_id:o}}}),M=e=>c(void 0,null,function*(){try{if(e.startsWith("sess_"))return S(e);const{data:t,error:r}=yield l(a.functions.invoke(`checkout-get/${e}`,{method:"GET"}),5e3);if(r)throw r;return t}catch(t){return S(e)}}),W=e=>c(void 0,null,function*(){const t=m(e);try{const{data:r,error:o}=yield l(a.functions.invoke("get-wallet-address",{body:{crypto:t}}),5e3);if(o)throw o;return r}catch(r){const o={BTC:"bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh",ETH:"0x71C7656EC7ab88b098defB751B7401B5f6d8976F",LTC:"ltc1qgqp5427d9290w506505671029302",USDT:"TXj129048120948120948120948"};return{address:o[t]||o.BTC}}}),N=(e,t)=>c(void 0,null,function*(){const r=m(e);try{const{data:o,error:n}=yield l(a.functions.invoke("get-crypto-amount",{body:{coin:r,usdAmount:t}}),5e3);if(n)throw n;return o}catch(o){try{if(r==="USDT")return{requiredCryptoAmount:t};const p=`${r}USDT`,i=new AbortController,s=setTimeout(()=>i.abort(),3e3),u=yield fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${p}`,{signal:i.signal});if(clearTimeout(s),u.ok){const y=yield u.json();if(y.price){const k=parseFloat(y.price);return{requiredCryptoAmount:t/k}}}}catch(p){}const n={BTC:95e3,ETH:3500,LTC:100,USDT:1},d=n[r]||n.BTC;return{requiredCryptoAmount:t/d}}}),R=e=>c(void 0,null,function*(){try{const{data:t,error:r}=yield l(a.functions.invoke("super-handler",{body:{paymentId:e,traceId:`frontend-${Math.random().toString(36).substring(7)}`}}),4e3);if(r)throw r;return t}catch(t){return null}}),L=e=>c(void 0,null,function*(){try{e.crypto=m(e.crypto);const{data:t,error:r}=yield a.from("payment").insert([e]).select().single();if(r)throw r;return t}catch(t){return{id:`mock_pay_${Date.now()}`,status:"pending"}}}),z=e=>c(void 0,null,function*(){try{if(e.startsWith("sess_"))return null;const{data:t,error:r}=yield a.from("payment").select("*").eq("session_id",e).order("created_at",{ascending:!1}).limit(1).maybeSingle();return r?null:t}catch(t){return null}}),F=e=>c(void 0,null,function*(){try{if(e.startsWith("mock_"))return!0;const{error:t}=yield a.from("payment").update({status:"cancelled"}).eq("id",e);if(t)throw t;return!0}catch(t){return!1}});export{F as cancelPayment,R as checkPaymentStatus,L as createPayment,x as disconnectRealtime,M as getCheckoutSession,N as getCryptoAmount,I as getIp,z as getPaymentBySessionId,W as getWalletAddress,j as initiateCheckoutSession,a as supabase};
